<!DOCTYPE html>
<html lang="pt-BR">
<meta charset="UTF-8">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Meus Links Úteis</title>
   
</head>
<body>
    <div class="container">
        <h1>🔗 Meus Links Úteis</h1>
        
        <div id="loading" class="loading">Carregando seus links...</div>
        
        <div class="links-container" id="links">
            <!-- Links salvos no Firebase serão exibidos aqui -->
        </div>
        
        <!-- Formulário para adicionar links -->
        <div class="form-container fade-in">
            <h2 class="form-title">➕ Adicionar Novo Link</h2>
            <form id="form">
                <div class="form-row">
                    <input type="text" id="link" placeholder="🔗 Cole o link aqui" required>
                    <input type="text" id="linkName" placeholder="📝 Nome do Link" required>
                </div>
                <div class="form-row">
                    <select id="color">                
                        <option value="blue">🔵 Azul</option>
                        <option value="green">🟢 Verde</option>
                        <option value="orange">🟠 Laranja</option>
                        <option value="purple">🟣 Roxo</option>
                        <option value="yellow">🟡 Amarelo</option>
                        <option value="red">🔴 Vermelho</option>
                        <option value="purple-dark">🟣 Roxo Escuro</option>
                        <option value="orange-light">🟠 Laranja Claro</option>
                        <option value="blue-royal">🔵 Azul Royal</option>
                        <option value="pink">🟡 Rosa</option>
                        <option value="yellow-dark">🟡 Amarelo Escuro</option>
                    </select>
                    <button type="submit" class="btn btn-primary">Adicionar Link</button>
                </div>
            </form>
        </div>

        <!-- Formulário para excluir links -->
        <div class="form-container fade-in">
            <h2 class="form-title">🗑️ Gerenciar Links</h2>
            <form id="delete-form">
                <div class="form-row">
                    <select id="delete-select">
                        <option value="-1">Selecione um link para excluir</option>
                    </select>
                    <button type="submit" class="btn btn-danger">Excluir Link</button>
                </div>
            </form>
        </div>

        <!-- Importar links -->
        <div class="form-container fade-in">
            <h2 class="form-title">📥 Importar Links</h2>
            <div class="form-row">
                <input type="file" id="file-input" accept=".txt,.json">
                <button id="importLinksButton" class="btn btn-success">Importar Links</button>
            </div>
        </div>
    </div>

    <!-- Botões flutuantes -->
    <div class="floating-buttons">
        <button id="downloadLinksButton" class="floating-btn download tooltip">
            📥
            <span class="tooltiptext">Baixar Links</span>
        </button>
        <button id="clear-cache-btn" class="floating-btn danger tooltip">
            🗑️
            <span class="tooltiptext">Limpar Tudo</span>
        </button>
    </div>

    <!-- Rodapé -->
    <footer class="footer">
        <p>&copy; 2024 - Helio Goes Junior - Todos os direitos reservados</p>
        <p style="font-size: 14px; margin-top: 8px; color: var(--text-secondary);">
            Powered by Firebase & Windows 11 Design
        </p>
    </footer>

    <!-- Firebase SDK -->
    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, push, set, get, remove, onValue } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-analytics.js";

        // Your web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCHimH-hvDo2uedCijx8LKXMY_Z8fkLJS0",
            authDomain: "appsworksh.firebaseapp.com",
            databaseURL: "https://appsworksh-default-rtdb.firebaseio.com",
            projectId: "appsworksh",
            storageBucket: "appsworksh.firebasestorage.app",
            messagingSenderId: "910353044495",
            appId: "1:910353044495:web:b82a2c3d0a69dcfd663f7a",
            measurementId: "G-40DBMDT52V"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const analytics = getAnalytics(app);
        const database = getDatabase(app);

        // Referência para os links no Firebase
        const linksRef = ref(database, 'links');

        // Variável global para armazenar os links
        let linksData = [];

        // Função para carregar os links salvos no Firebase
        function loadLinksFromFirebase() {
            const loadingDiv = document.getElementById('loading');
            loadingDiv.style.display = 'block';
            
            onValue(linksRef, (snapshot) => {
                try {
                    const data = snapshot.val();
                    linksData = [];
                    const linksDiv = document.getElementById('links');
                    linksDiv.innerHTML = '';
                    
                    if (data) {
                        // Converter object para array e ordenar por timestamp
                        const linksArray = Object.entries(data).map(([key, value]) => ({
                            id: key,
                            ...value
                        })).sort((a, b) => (b.timestamp || 0) - (a.timestamp || 0));
                        
                        linksArray.forEach((linkData, index) => {
                            linksData.push(linkData);
                            const button = createLinkButton(linkData.url, linkData.color, linkData.name);
                            button.classList.add('fade-in');
                            button.style.animationDelay = `${index * 0.1}s`;
                            linksDiv.appendChild(button);
                        });
                    }
                    
                    updateDeleteSelectOptions();
                    loadingDiv.style.display = 'none';
                } catch (error) {
                    console.error("Erro ao carregar links:", error);
                    loadingDiv.innerHTML = 'Erro ao carregar links. Tente novamente.';
                }
            });
        }

        // Função para adicionar um link ao Firebase
        async function addLinkToFirebase(url, color, name) {
            try {
                const newLinkRef = push(linksRef);
                await set(newLinkRef, {
                    url: url,
                    color: color,
                    name: name,
                    timestamp: Date.now()
                });
                
                // Feedback visual
                showNotification('✅ Link adicionado com sucesso!', 'success');
            } catch (error) {
                console.error("Erro ao adicionar link:", error);
                showNotification('❌ Erro ao adicionar link. Tente novamente.', 'error');
            }
        }

        // Função para deletar um link do Firebase
        async function deleteLinkFromFirebase(linkId) {
            try {
                const linkRef = ref(database, `links/${linkId}`);
                await remove(linkRef);
                
                showNotification('🗑️ Link excluído com sucesso!', 'success');
            } catch (error) {
                console.error("Erro ao excluir link:", error);
                showNotification('❌ Erro ao excluir link. Tente novamente.', 'error');
            }
        }

        // Função para limpar todos os links do Firebase
        async function clearAllLinksFromFirebase() {
            try {
                await remove(linksRef);
                showNotification('🧹 Todos os links foram removidos!', 'success');
            } catch (error) {
                console.error("Erro ao limpar links:", error);
                showNotification('❌ Erro ao limpar links. Tente novamente.', 'error');
            }
        }

        // Função para criar um botão de link
        function createLinkButton(url, color, name) {
            const button = document.createElement('a');
            button.href = url;
            button.className = 'button button-' + color;
            button.target = '_blank';
            button.textContent = name;
            return button;
        }

        // Função para baixar os links em um arquivo de texto
        function downloadLinks() {
            const jsonString = JSON.stringify(linksData.map(link => ({
                url: link.url,
                color: link.color,
                name: link.name
            })), null, 2);
            const blob = new Blob([jsonString], { type: "application/json" });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `meus-links-${new Date().toISOString().split('T')[0]}.json`;
            a.style.display = 'none';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showNotification('📥 Links baixados com sucesso!', 'success');
        }

        // Função para mostrar notificações
        function showNotification(message, type) {
            const notification = document.createElement('div');
            notification.innerHTML = message;
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 16px 24px;
                border-radius: 8px;
                color: white;
                font-weight: 500;
                z-index: 9999;
                animation: slideIn 0.3s ease;
                max-width: 300px;
                box-shadow: 0 4px 16px rgba(0, 0, 0, 0.2);
            `;
            
            if (type === 'success') {
                notification.style.background = '#107c10';
            } else {
                notification.style.background = '#d83b01';
            }
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                }, 300);
            }, 3000);
        }

        // Função para importar links de um arquivo
        function importLinksFromFile(file) {
            const reader = new FileReader();

            reader.onload = async function (event) {
                try {
                    const fileContent = event.target.result;
                    let importedLinks;
                    
                    try {
                        importedLinks = JSON.parse(fileContent);
                    } catch {
                        // Se não for JSON, tenta como texto simples
                        const lines = fileContent.split('\n').filter(line => line.trim());
                        importedLinks = lines.map(line => ({
                            url: line.trim(),
                            name: 'Link Importado',
                            color: 'blue'
                        }));
                    }
                    
                    if (Array.isArray(importedLinks)) {
                        let imported = 0;
                        for (const link of importedLinks) {
                            if (link.url && link.name && link.color) {
                                await addLinkToFirebase(link.url, link.color, link.name);
                                imported++;
                            }
                        }
                        showNotification(`📥 ${imported} links importados com sucesso!`, 'success');
                    } else {
                        showNotification('❌ Formato de arquivo inválido.', 'error');
                    }
                } catch (error) {
                    console.error("Erro ao importar links:", error);
                    showNotification('❌ Erro ao importar links.', 'error');
                }
            };

            reader.readAsText(file);
        }

        // Função para atualizar as opções do menu de exclusão
        function updateDeleteSelectOptions() {
            const deleteSelect = document.getElementById('delete-select');
            deleteSelect.innerHTML = '<option value="-1">Selecione um link para excluir</option>';
            
            linksData.forEach(function (link, index) {
                const option = document.createElement('option');
                option.value = index;
                option.text = link.name;
                deleteSelect.appendChild(option);
            });
        }

        // Event Listeners
        window.onload = function () {
            loadLinksFromFirebase();
            
            // Adicionar estilos para animações
            const style = document.createElement('style');
            style.textContent = `
                @keyframes slideIn {
                    from { transform: translateX(100%); opacity: 0; }
                    to { transform: translateX(0); opacity: 1; }
                }
                @keyframes slideOut {
                    from { transform: translateX(0); opacity: 1; }
                    to { transform: translateX(100%); opacity: 0; }
                }
            `;
            document.head.appendChild(style);
        };

        document.getElementById('downloadLinksButton').addEventListener('click', downloadLinks);

        document.getElementById('form').addEventListener('submit', async function (event) {
            event.preventDefault();
            const link = document.getElementById('link').value;
            const color = document.getElementById('color').value;
            const name = document.getElementById('linkName').value;

            await addLinkToFirebase(link, color, name);
            
            // Limpar o formulário
            document.getElementById('link').value = '';
            document.getElementById('linkName').value = '';
        });

        document.getElementById('delete-form').addEventListener('submit', async function (event) {
            event.preventDefault();
            const deleteIndex = document.getElementById('delete-select').value;
            
            if (deleteIndex !== "-1") {
                const linkToDelete = linksData[deleteIndex];
                await deleteLinkFromFirebase(linkToDelete.id);
            }
        });

        // Importar links
        document.getElementById('importLinksButton').addEventListener('click', function () {
            const fileInput = document.getElementById('file-input');
            const file = fileInput.files[0];

            if (file) {
                importLinksFromFile(file);
                fileInput.value = ''; // Limpar o input
            } else {
                showNotification('❌ Selecione um arquivo para importar.', 'error');
            }
        });

        // Limpar todos os links
        document.getElementById('clear-cache-btn').addEventListener('click', async function () {
            const senha = prompt("🔐 Digite a senha para limpar todos os links:");
            if (senha === '123') {
                await clearAllLinksFromFirebase();
            } else if (senha !== null) {
                showNotification('❌ Senha incorreta.', 'error');
            }
        });
    </script>
</body>
</html>
